package com.stream_suite.link.util

import org.junit.Test
import junit.framework.Assert.*
import com.stream_suite.link.shared.util.OneTimePasswordParser

class OneTimePasswordParserTest : com.stream_suite.link.MessengerRobolectricSuite() {

    private class OtpValidator(val phrase: String, val expectation: String?)

    private val tests = listOf(
            OtpValidator("your google verification code is 123456", "123456"),
            OtpValidator("g-123456 is your google verification code.", "123456"),
            OtpValidator("(alibaba group) your verification code for validation is ABC123.", "ABC123"),
            OtpValidator("123456 (wechat verification code)", "123456"),
            OtpValidator("you edit your personal info now. check code: ABC123. please submit the code within 30 minutes. (alipay)", "ABC123"),
            OtpValidator("123456 (netease verification code)", "123456"),
            OtpValidator("your lyft code is 123456", "123456"),
            OtpValidator("123456 is your facebook confirmation code", "123456"),
            OtpValidator("microsoft account verification code: 123456", "123456"),
            OtpValidator("123456 is your amazon security code.", "123456"),
            OtpValidator("your code is: ABC123. thank you.", "ABC123"),
            OtpValidator("123456 verification code from qq.", "123456"),
            OtpValidator("use 123456 as microsoft account security code", "123456"),
            OtpValidator("your apple id verification code is: 123456", "123456"),
            OtpValidator("paypal: your security code is: ABC123. your code expires in 5 minutes. please don't reply.", "ABC123"),
            OtpValidator("your twitter confirmation code is ABC123.", "ABC123"),
            OtpValidator("vanguard security code: 123456 code expires in 10 minutes. reply help for help, stop to cancel, msg&data rates may apply", "123456"),
            OtpValidator("123456 is your twitter login code.", "123456"),
            OtpValidator("123456 is your aol verification code.", "123456"),
            OtpValidator("123456 is your facebook password reset code or reset your password here: <url>", "123456"),
            OtpValidator("your linkedin verification code is ABC123.", "ABC123"),
            OtpValidator("craigslist secret code for <email> is ABC123. do not share this code for any reason. any request for it is a scam.", "ABC123"),
            OtpValidator("you are applying a weibo account, verification code: ABC123 (expire in 30 mins).", "ABC123"),
            OtpValidator("your verification code is ABC123.", "ABC123"),
            OtpValidator("(taobao) your verification code for registration is ABC123. for enquire, please call redacted_phone_number.", "ABC123"),
            OtpValidator("your facebook security code: 123456", "123456"),
            OtpValidator("snapchat code: ABC123. happy snapping!", "ABC123"),
            OtpValidator("your venmo verification code is 123456", "123456"),
            OtpValidator("your security code is ABC123. happy dropboxing!", "ABC123"),
            OtpValidator("bank of america: 123456 is your authorization code which expires in 10 minutes. if you didn't request the code, call redacted_phone_number for assistance.", "123456"),
            OtpValidator("your <unk> registration code is 123456", "123456"),
            OtpValidator("your icloud keychain verification code is: 123456", "123456"),
            OtpValidator("use 123456 as microsoft account password reset code", "123456"),
            OtpValidator("paypal: your security code is: ABC123. your code expires in 10 minutes. please don't reply.", "ABC123"),
            OtpValidator("(1/2) (taobao) your verification code for registration is ABC123. for en", "ABC123"),
            OtpValidator("your turbotax verification code is: 123456", "123456"),
            OtpValidator("paypal: 123456 is your security code. this code expires in 5 minutes. please do not reply to this message.", "123456"),
            OtpValidator("your waze verification code is 123456 (wazeapp)", "123456"),
            OtpValidator("telegram code 123456", "123456"),
            OtpValidator("123456 verification code", "123456"),
            OtpValidator("123456 is your facebook confirmation code#fb", "123456"),
            OtpValidator("(ABC123) is your naver verification code.", "ABC123"),
            OtpValidator("you apply digital certificate now. please confirm the format of url is https://*.alipay.com/*. check code: ABC123. (alipay)", "ABC123"),
            OtpValidator("use 123456 as your login code for tinder. (account kit by facebook)", "123456"),
            OtpValidator("your viber code is: ABC123. close this message and enter the code into viber to activate your account.", "ABC123"),
            OtpValidator("123456 is your google verification code.", "123456"),
            OtpValidator("please use the code 123456 to verify your phone for namecheap two-factor authentication.", "123456"),
            OtpValidator("fr: chase online identification code: ABC123 enter online at prompt or in password field at logon reply help for help reply stop to cncl", "ABC123"),
            OtpValidator("123456 is your amazon verification code", "123456"),
            OtpValidator("your bank of america safepass code is \"ABC123\". this code will expire in 10 minutes. please do not reply to this message.", "ABC123"),
            OtpValidator("your verification code for validation is ABC123. (alibaba group)", "ABC123"),
            OtpValidator("your <unk> verification code is: 123456", "123456"),
            OtpValidator("your sms verification code is 123456 .", "123456"),
            OtpValidator("your waze verification code is 123456", "123456"),
            OtpValidator("stanford authentication code: 123456", "123456"),
            OtpValidator("your netflix verification code is ABC123.", "ABC123"),
            OtpValidator("from capital one: the one-time code you requested is ABC123. please use this code to complete your request.", "ABC123"),
            OtpValidator("circle verification code: 123456", "123456"),
            OtpValidator("123456 is your facebook messenger for android confirmation code", "123456"),
            OtpValidator("your ebay code is ABC123", "ABC123"),
            OtpValidator("craigslist secret code for redacted_email_address is ABC123. do not share this code for any reason. any request for it is a scam.", "ABC123"),
            OtpValidator("your mint verification code is: 123456", "123456"),
            OtpValidator("your aol verification code is ABC123. reply help for help, stop to cancel. <unk> /help. msg&data rates may apply.", "ABC123"),
            OtpValidator("your smsglobal verification code is 123456", "123456"),
            OtpValidator("fr: chase online identification code: ABC123 enter online at prompt or in password field at logon w/in 30 minutes", "ABC123"),
            OtpValidator("microsoft account security code: 123456", "123456"),
            OtpValidator("confirmation code: ABC123. enter this code in your app. (digits by twitter)", "ABC123"),
            OtpValidator("enter this code to reset your twitter password: ABC123", "ABC123"),
            OtpValidator("your mint code is 123456", "123456"),
            OtpValidator("fr: chase online identification code: ABC123 enter online at prompt or in password field at logon", "ABC123"),
            OtpValidator("123456 is your yahoo verification code.", "123456"),
            OtpValidator("123456 is your facebook confirmation code, or go to <url>", "123456"),
            OtpValidator("123456 is your github authentication code.", "123456"),
            OtpValidator("use 123456 as your instagram security code.", "123456"),
            OtpValidator("123456 is your check code (don't disclose it to anyone). (alipay)", "123456"),
            OtpValidator("your glide code is 123456", "123456"),
            OtpValidator("sms code ABC123, please don't disclose sms code to anyone. (alipay)", "ABC123"),
            OtpValidator("your perk account verification code is: 123456", "123456"),
            OtpValidator("your viber code is: 123456 close this message and enter the code into viber to activate your account.", "123456"),
            OtpValidator("123456 is your facebook password reset code", "123456"),
            OtpValidator("(1/2) you are attempting to log into alipay. please check your verification code: ABC123. (do not disclose this code to any", "ABC123"),
            OtpValidator("paypal: your confirmation code is: ABC123. your code expires in 5 minutes. please don't reply.", "ABC123"),
            OtpValidator("your <employers>verification code is 123456", "123456"),
            OtpValidator("123456 is your facebook security code. to verify your account, please paste this code on the page that requested it.", "123456"),
            OtpValidator("your skype caller id confirmation code is ABC123", "ABC123"),
            OtpValidator("use wells fargo advanced access code 123456 to access your account.", "123456"),
            OtpValidator("here's your xfinity verification code: ABC123.", "ABC123"),
            OtpValidator("your 2-step verification code: 123456", "123456"),
            OtpValidator("your evernote verification code is: 123456", "123456"),
            OtpValidator("123456 lastpass security code", "123456"),
            OtpValidator("partners healthcare: please enter 123456 as your one-time confirmation code to access our network.", "123456"),
            OtpValidator("please use the code 123456 to confirm access to your phone for login approvals.", "123456"),
            OtpValidator("you ask to pay the transaction. check code: ABC123. don't disclose this code to anyone. (alipay)", "ABC123"),
            OtpValidator("your carbonite security code is: ABC123.", "ABC123"),
            OtpValidator("123456 is your messenger confirmation code", "123456"),
            OtpValidator("your verification code is: 123456", "123456"),
            OtpValidator("use code 123456 to confirm your mobile number.", "123456"),
            OtpValidator("your security code is 123456", "123456"),
            OtpValidator("fidelity investments msg: your security code is: ABC123. enter it online to complete your transaction. thank you.", "ABC123"),
            OtpValidator("ABC123 is your code to reset your twitter password. don't reply to this message with your code.", "ABC123"),
            OtpValidator("empower retirement alerts: your verification code 123456 is good for 30 minutes. visit <url> for questions.", "123456"),
            OtpValidator("your confirmation code is ABC123. please enter it in the text field.", "ABC123"),
            OtpValidator("123456 is your mailchimp verification code.", "123456"),
            OtpValidator("your one-time registration code is 123456", "123456"),
            OtpValidator("associated cu access code. your access code is ABC123. reply help for help", "ABC123"),
            OtpValidator("your code is: ABC123. go to facebook and enter it to confirm. #fb", "ABC123"),
            OtpValidator("ABC123 is your verification code for your sony entertainment network account.", "ABC123"),
            OtpValidator("(<employers>) your verification code for validation is ABC123.", "ABC123"),
            OtpValidator("123456 is your verification code for your sony entertainment network account.", "123456"),
            OtpValidator("your facebook security code is ABC123. to verify your account, please paste this code on the page that requested it.", "ABC123"),
            OtpValidator("your paychex temporary verification code is: ABC123. this code will expire in 5 minutes. thanks!", "ABC123"),
            OtpValidator("your google calendar verification code is ABC123. standard charges may apply to receive messages. for info text help, or to cancel text stop to 123456", "ABC123"),
            OtpValidator("your symantec vip temporary security code is ABC123.", "ABC123"),
            OtpValidator("use uber code 123456 to confirm your number", "123456"),
            OtpValidator("enter code: 123456 into periscope. (digits by twitter)", "123456"),
            OtpValidator("whatsapp code 123456", "123456"),
            OtpValidator("facebook mobile confirmation code: ABC123", "ABC123"),
            OtpValidator("123456 is your facebook security code. or follow this link: <url>", "123456"),
            OtpValidator("imo code: 123456", "123456"),
            OtpValidator("your account center unique id code is: 123456", "123456"),
            OtpValidator("your aol registration one-time verification code is ABC123. reply help for help, stop to cancel. <unk> /help. msg&data rates may apply.", "ABC123"),
            OtpValidator("<unk> access code. your access code is ABC123. reply help for help", "ABC123"),
            OtpValidator("your voya verification code is 123456", "123456"),
            OtpValidator("123456 is your facebook confirmation code or visit <url>", "123456"),
            OtpValidator("snapchat code: ABC123. happy snapping! or tap: <url>", "ABC123"),
            OtpValidator("<url> slack login code: 123456", "123456"),
            OtpValidator("truecaller code 123456", "123456"),
            OtpValidator("you apply registration with mobile phone number. activation code: ABC123. (alipay)", "ABC123"),
            OtpValidator("your talkatone validation code is 123456", "123456"),
            OtpValidator("you install digital certificate now. please confirm the format of url is https://*.alipay.com/*. check code: ABC123. (alipay)", "ABC123"),
            OtpValidator("your paypal security code is 123456 . this code expires in 5 minutes. please do not reply to this message.", "123456"),
            OtpValidator("123456 is your adobe code for adding this phone to your profile.", "123456"),
            OtpValidator("naver verification code: 123456", "123456"),
            OtpValidator("your verification code is 123456 - blizzard entertainment", "123456"),
            OtpValidator("your identification code is 123456", "123456"),
            OtpValidator("facebook password reset code: ABC123. or reset your password here: <url>", "ABC123"),
            OtpValidator("your simple verification code is 123456", "123456"),
            OtpValidator("your verification code is 123456", "123456"),
            OtpValidator("123456 is your yahoo! verification code.", "123456"),
            OtpValidator("your twitter confirmation code is ABC123. enter this code in the twitter app to confirm your phone number.", "ABC123"),
            OtpValidator("to verify your identity, use wells fargo advanced access code 123456 online only. we will not call or text you for this code.", "123456"),
            OtpValidator("check code: ABC123. you use alipay now and validation is required. don't disclose this code to anyone. (alipay)", "ABC123"),
            OtpValidator("your marco polo code is 123456", "123456"),
            OtpValidator("<unk> id: your one-time confirmation code is: 123456 message/data rates may apply.", "123456"),
            OtpValidator("bank of redacted_us_state messages. the one-time code is ABC123. please enter and submit it online. msg&data rates may apply/stop if unexpected/help for support", "ABC123"),
            OtpValidator("your quickbooks verification code is: 123456", "123456"),
            OtpValidator("your gotomypc verification code is ABC123. use it within 10 minutes to sign in to your account.", "ABC123"),
            OtpValidator("123456 is your <url> one-time security code.", "123456"),
            OtpValidator("your verification code for validation is ABC123.", "ABC123"),
            OtpValidator("123456 logmein accounts security code", "123456"),
            OtpValidator("123456 is your alipay payment check code (don't disclose it to anyone). total amount <unk> (alipay)", "123456"),
            OtpValidator("your turbotax code is 123456", "123456"),
            OtpValidator("microsoft account security code: 123456", "123456"),
            OtpValidator("your lyft verification code is 123456", "123456"),
            OtpValidator("your one-time registration code is ABC123. this code will expire in 10 minutes.", "ABC123"),
            OtpValidator("123456 is your venmo phone verification code. enter it at <url> or in the venmo app to verify your account.", "123456"),
            OtpValidator("your <unk> verification code is 123456", "123456"),
            OtpValidator("your coinbase code is 123456", "123456"),
            OtpValidator("your one-time verification code for becu online banking is: ABC123. questions? call <phone>", "ABC123"),
            OtpValidator("your talk2 verification code is ABC123", "ABC123"),
            OtpValidator("you edit your personal info now. check code: ABC123. please submit the code within 30 minutes. (<employers>)", "ABC123"),
            OtpValidator("your dingtone access code: 123456 enter the code into dingtone app to activate your dingtone account.", "123456"),
            OtpValidator("your one-time registration code is ABC123.", "ABC123"),
            OtpValidator("your intuit verification code is: 123456", "123456"),
            OtpValidator("you are attempting to log into alipay. please check your verification code: ABC123. (do not disclose this code to anyone). (alipay)", "ABC123"),
            OtpValidator("123456 is your simple confirmation code.", "123456"),
            OtpValidator("your verification code: 123456", "123456"),
            OtpValidator("123456 (<employers> verification code)", "123456"),
            OtpValidator("your tumblr auth code is 'ABC123'. it will expire in two minutes.", "ABC123"),
            OtpValidator("123456 is your airbnb verification code.", "123456"),
            OtpValidator("redacted_us_male_name, 123456 is your venmo phone verification code. enter it at <url> or in the venmo app to verify your account.", "123456"),
            OtpValidator("123456 logmein security code", "123456"),
            OtpValidator("you cancel the digital certificate now. please confirm the format of url is https://*.alipay.com/*. check code: ABC123. (alipay)", "ABC123"),
            OtpValidator("your american express personal savings one-time identification code is: 123456 msg&data rates may <unk> stop to end, or txt help", "123456"),
            OtpValidator("your oovoo verification code is 123456", "123456"),
            OtpValidator("your norton security code is 123456", "123456"),
            OtpValidator("best buy account recovery: your verification code is ABC123", "ABC123"),
            OtpValidator("use wells fargo advanced access code 123456 to verify your identity.", "123456"),
            OtpValidator("your registration code is 123456", "123456"),
            OtpValidator("123456 is your messenger code to verify your phone number", "123456"),
            OtpValidator("imo verification code: 123456", "123456"),
            OtpValidator("vanguard validation code: 123456 code expires in 10 minutes. reply help for help, stop to cancel, msg&data rates may apply", "123456"),
            OtpValidator("your symantec vip security code is ABC123.", "ABC123"),
            OtpValidator("your steam confirmation code is 123456", "123456"),
            OtpValidator("your yahoo verification code is ABC123", "ABC123"),
            OtpValidator("gofundme verification code: ABC123. this code was sent because you have two-factor authentication enabled on your gofundme payment account.", "ABC123"),
            OtpValidator("code 123456", "123456"),
            OtpValidator("123456 sideline validation code", "123456"),
            OtpValidator("your vine verification code is: 123456", "123456"),
            OtpValidator("your quicken verification code is 123456", "123456"),
            OtpValidator("<unk> verification code: 123456", "123456"),
            OtpValidator("<phone> says: 123456 (wechat verification code)", "123456"),
            OtpValidator("xoom.com: enter 123456 into the security code field", "123456"),
            OtpValidator("onb access code. your access code is ABC123. reply help for help", "ABC123"),
            OtpValidator("123456 is your citi identification code. this code will expire in 10 minutes. please enter it online when prompted. help=info stop=suspend this msg. msg&data rates may apply", "123456"),
            OtpValidator("verification code: 123456", "123456"),
            OtpValidator("my wallet authentication code: ABC123", "ABC123"),
            OtpValidator("microsoft account verification code: 123456 visit <url> to complete verification", "123456"),
            OtpValidator("the access code you requested is ABC123. if you received this text in error, call redacted_phone_number. text replies aren't accepted.", "ABC123"),
            OtpValidator("your aol verification code is a-ABC123.", "ABC123"),
            OtpValidator("your lastpass verification code is 123456", "123456"),
            OtpValidator("your square verification code: 123456", "123456"),
            OtpValidator("123456 is your verification code from yahoo", "123456"),
            OtpValidator("this is an automated sms from mailchimp. your verification code is 123456", "123456"),
            OtpValidator("coinbase secure code: 123456", "123456"),
            OtpValidator("your coinbase verification code is 123456", "123456"),
            OtpValidator("verification code for coinbase: 123456", "123456"),
            OtpValidator("coinbase code: 123456", "123456"),
            OtpValidator("coinbase verification code 123456", "123456"),
            OtpValidator("your quickbooks code is 123456", "123456"),
            OtpValidator("123456 is your uber code.", "123456"),
            OtpValidator("your github authentication code is: 123456", "123456"),
            OtpValidator("enter uber code 123456 to confirm your number", "123456"),
            OtpValidator("adp: your security code: 123456", "123456"),
            OtpValidator("uber verification code: 123456", "123456"),
            OtpValidator("your uber code is 123456", "123456"),
            OtpValidator("your uber confirmation code is 123456", "123456"),
            OtpValidator("123456 is your uber confirmation code.", "123456"),
            OtpValidator("your uber code: 123456", "123456"),
            OtpValidator("uber code: 123456", "123456"),
            OtpValidator("your <unk> code is 123456", "123456"),
            OtpValidator("last step! enter code 123456 to confirm your number for uber", "123456"),
            OtpValidator("state farm: your verification code is: ABC123. if you didn't request this, call redacted_phone_number. reply help for help.", "ABC123"),
            OtpValidator("here's your uber code: 123456", "123456"),
            OtpValidator("m+access code: 123456 message id: htew5379", "123456"),
            OtpValidator("coupons.com one-time verification code 123456", "123456"),
            OtpValidator("your vrbo verification code is 123456", "123456"),
            OtpValidator("your <unk> authentication code is: 123456", "123456"),
            OtpValidator("code is 123456", "123456"),
            OtpValidator("your <unk> otp code: ABC123", "ABC123"),
            OtpValidator("123456 is Your Yahoo Account Key", "123456"),
            OtpValidator("123456 is Amine's Facebook confirmation code #fb", "123456"),
            OtpValidator("Use 123456 as your password for facebook for android", "123456"),
            OtpValidator("Use 123456 as your password for facebook messenger for android", "123456"),
            OtpValidator("Use 123456 as your password for facebook for iphone", "123456"),
            OtpValidator("Use 123456 as your password for spotify", "123456"),
            OtpValidator("Use 123456 as your password for os x", "123456"),
            OtpValidator("123456 is your yahoo account key", "123456"),
            OtpValidator("123456 is your otp for <unk>", "123456"),
            OtpValidator("123456 is your otp for bookmyshow world", "123456"),
            OtpValidator("your Washington coast credit union security passcode is 123456", "123456"),
            OtpValidator("Your WhatsApp code is 123-456 but you can simply tap on this link to verify your device:", "123-456"),
            OtpValidator("[#] 123456 is your Uber code.", "123456"),
            OtpValidator("123456 is your Dynamic Access Code for CRN xxxx189.", "123456")
    )

    private val invalidTests = listOf(
            OtpValidator("hey my number is 123456", null),
            OtpValidator("", null),
            OtpValidator("no number here", null),
            OtpValidator("123456", null)
    )

    @Test
    fun matchOtp() {
        tests.forEach {
            assertEquals(it.phrase, it.expectation, OneTimePasswordParser.getOtp(it.phrase))
        }
    }

    @Test
    fun doesNotMatchInvalidOtp() {
        invalidTests.forEach {
            assertEquals(it.phrase, it.expectation, OneTimePasswordParser.getOtp(it.phrase))
        }
    }

}